{% extends 'Admin/Redis/redis_base.html' %}
{% load static i18n hosts %}

{% block menu-redis-string-active %} active {% endblock %}

{% block breadcrumb %}
  {{ block.super }}
  <li>
    <a href="{% host_url 'admin-redis-string' host 'admin' %}">{% trans 'String' %}</a>
  </li>
{% endblock %}

{% block content %}
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
        <h5>{% trans 'Form' %}</h5>
        <div class="ibox-tools">
          <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
          </a>
        </div>
      </div>
      <div class="ibox-content">
        {% include 'base_form.html' with form=form %}
      </div>
    </div>
  </div>
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
        <h5>{% trans 'Table' %}</h5>
        <div class="ibox-tools">
          <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
          </a>
        </div>
      </div>
      <div class="ibox-content">
        <table class="table">
          <thead>
          <tr>
            <th>#</th>
            <th>{% trans 'Key' %}</th>
            <th>{% trans 'Value' %}</th>
            <th>{% trans 'EX' %}</th>
            <th>{% trans 'Approx EX in real time' %}</th>
          </tr>
          </thead>
          <tbody>
          {% for item in data %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ item.key }}</td>
              <td>{{ item.value }}</td>
              <td>{{ item.ttl|default_if_none:'' }}</td>
              <td class="countdown">{{ item.ttl|default_if_none:'' }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>

      </div>
    </div>
  </div>
{% endblock %}

{% block extra-js %}
  <script>
    $(document).ready(function () {
      function updateCountdown() {
        $(".countdown").each(function () {
          let countText = $(this).text().trim();
          let count = parseInt(countText);

          if (countText === "" || isNaN(count)) {
            return; // Skip this element
          }

          count--;

          $(this).text(count);

          if (count <= 0) {
            clearInterval(countdownInterval);
            $(this).text("");
          }
        });
      }

      let countdownInterval = setInterval(updateCountdown, 1000);
    });
  </script>
{% endblock %}